{% load static %}
{% load letter_filters %}

<div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title fw-bold">Задача № {{ problem.number }}</h5>
    <p class="card-text">{{ problem.text|safe }}</p>

    {% if problem.illustration %}
      <div class="mb-3 text-center">
        <img src="{{ problem.illustration.url }}" alt="Иллюстрация к задаче" class="img-fluid" style="max-height: 400px;">
      </div>
    {% endif %}


    {# ----- Если это задача с сопоставлением ----- #}
    {% if problem.task_type == "match" %}
      <div class="row">
        <!-- Левая колонка -->
        <div class="col-md-6">
          <table class="table table-bordered align-middle text-center">
            <tbody>
              {% for left in problem.left_options.all %}
              <tr>
                <!-- Буква слева -->
                <td class="fw-bold align-middle" style="width: 50px;">
                  {{ left.label|cyrillic }}
                </td>
                <!-- Картинка справа -->
                <td>
                  {% if left.image %}
                    <img src="{{ left.image.url }}"
                         alt="{{ left.label }}"
                         class="img-fluid"
                         style="max-height: 120px;">
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Правая колонка -->
        <div class="col-md-6">
          <table class="table table-bordered align-middle">
            <tbody>
              {% for right in problem.right_options.all %}
              <tr>
                <td>{{ forloop.counter }}) {{ right.text }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Ответ: таблица для выбора -->
      <form class="answer-form mt-3" data-problem-id="{{ problem.id }}">
        <table class="table table-bordered align-middle text-center w-auto">
          <thead>
            <tr>
              {% for left in problem.left_options.all %}
              <th>{{ left.label|cyrillic }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            <tr>
              {% for left in problem.left_options.all %}
              <td>
                <select class="form-select answer-select"
                        name="answer_{{ left.id }}"
                        data-correct-answer-id="{{ left.pair.right_option.id }}">
                  <option value="">—</option>
                  {% for right in problem.right_options.all %}
                  <option value="{{ right.id }}">{{ forloop.counter }}</option>
                  {% endfor %}
                </select>
              </td>
              {% endfor %}
            </tr>
          </tbody>
        </table>
        <button type="submit" class="btn btn-primary">Ответить</button>
      </form>
      <div class="answer-result mt-2"></div>

    {% else %}
    {# ----- Если это простая задача с текстовым ответом ----- #}
      <form class="answer-form mt-3"
            data-problem-id="{{ problem.id }}"
            data-correct-answer="{{ problem.correct_answer }}">
        <div class="input-group mb-3">
          <input type="text" class="form-control" name="answer" placeholder="Ваш ответ">
          <button type="submit" class="btn btn-primary">Ответить</button>
        </div>
      </form>
      <div class="answer-result mt-2"></div>
    {% endif %}
  </div>
</div>
